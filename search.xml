<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Ubuntu 22.04 出現 Daemons using outdated libraries 提示</title>
      <link href="/posts/Ubuntu-Daemons-using-outdated-libraries/"/>
      <url>/posts/Ubuntu-Daemons-using-outdated-libraries/</url>
      
        <content type="html"><![CDATA[<p>在使用 <code>apt</code> 安裝套件時，突然跳出一個視窗，寫著 <code>Daemons using outdated libraries</code>，不太敢動就先取消了。</p><p>查了一下發現是新版本的 Ubuntu 會在 <code>apt</code> 更新完套件後執行 <code>needrestart</code> 這個指令，用於告知有哪些服務需要<strong>重新啟動</strong>。預設行為就是打開這個互動式的介面。若使用腳本執行 <code>apt</code> 指令，跳出這個介面可能會導致腳本中斷。</p><p><img src="../../img/2023/Ubuntu-Daemons-using-outdated-libraries/Daemons-using-outdated-libraries.png" alt="Daemons using outdated libraries"></p><h2 id="解決方法">解決方法</h2><p>最極端的方法是直接移除 <code>needrestart</code> 套件，但這個套件是有用處的，因此我們透過修改設定檔的方式來解決。</p><p>打開 <code>/etc/needrestart/needrestart.conf</code> 這個檔案，其中一段如下：</p><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf"># Restart mode: (l)ist only, (i)nteractive or (a)utomatically.## ATTENTION: If needrestart is configured to run in interactive mode but is run# non-interactive (i.e. unattended-upgrades) it will fallback to list only mode.## $nrconf&#123;restart&#125; &#x3D; &#39;i&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先將最後一行取消註解，然後把 <code>i</code> 改成 <code>l</code> 或 <code>a</code>（我選擇 <code>a</code> 讓它自動執行重啟），然後存檔再跑一次 <code>needrestart</code> 讓剛剛應該重啟的跑一下。</p><h2 id="reference">Reference</h2><ul><li><a href="https://stackoverflow.com/questions/73397110/how-to-stop-ubuntu-pop-up-daemons-using-outdated-libraries-when-using-apt-to-i">linux - How to stop ubuntu pop-up “Daemons using outdated libraries” when using apt to install or update packages? - Stack Overflow</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 疑難雜症 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Poetry 管理 Python 套件</title>
      <link href="/posts/Python-Poetry/"/>
      <url>/posts/Python-Poetry/</url>
      
        <content type="html"><![CDATA[<h2 id="poetry-vs-pip">Poetry vs pip</h2><p>Poetry 與 pip 一樣可以用於套件管理，但多了以下功能：</p><ul><li>虛擬環境管理：使用內建的 venv 或 virtualenv 套件來建立及管理 Python 的虛擬環境，不同虛擬環境間彼此獨立</li><li><strong>套件相依性管理</strong>：管理環境中所安裝的全部套件及其版本。若一個套件被兩個以上的套件依賴 (dependency)，而彼此要求的<strong>版本範圍沒有交集</strong>，則套件可能會失效或無法安裝。</li><li>套件的打包與發布</li></ul><p>pip 的缺點：</p><ul><li>沒有完整套件相依性管理功能，難以乾淨地移除套件。</li><li>若一個套件有多個依賴套件，在使用 <code>pip uninstall</code> 時無法找出這些依賴套件並移除。若強行移除依賴套件可能會導致另一個依賴它的套件失效。</li></ul><h2 id="安裝-poetry">安裝 Poetry</h2><p>Poetry 主要有兩種<a href="https://python-poetry.org/docs/#installation">安裝方式</a>，官方推薦使用全域安裝。</p><ul><li><p>Linux, macOS, Windows (WSL)</p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://install.python-poetry.org <span class="token operator">|</span> python3 -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>Windows (Powershell)</p>  <pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token punctuation">(</span><span class="token function">Invoke-WebRequest</span> <span class="token operator">-</span>Uri https:<span class="token operator">/</span><span class="token operator">/</span>install<span class="token punctuation">.</span>python-poetry<span class="token punctuation">.</span>org <span class="token operator">-</span>UseBasicParsing<span class="token punctuation">)</span><span class="token punctuation">.</span>Content <span class="token punctuation">|</span> py <span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="poetry-安裝路徑">Poetry 安裝路徑</h3><ul><li>Unix 系統：<code>$HOME/.local/bin</code></li><li>Windows 系統：<code>%APPDATA%\Python\Scripts</code></li></ul><p>將此路徑加入<strong>環境變數</strong>即可在終端機直接使用 <code>poetry</code> 指令。</p><h2 id="初始化-poetry-專案設定">初始化 Poetry 專案設定</h2><p>每一個使用 Poetry 的專案都需要一個 <code>pyproject.toml</code> 設定檔，因此進入新的專案要先初始化。</p><p>首先進入專案資料夾並輸入 <code>poetry init</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>project folder<span class="token operator">></span>poetry init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>接著會進入互動式的介面，前六項可以直接 enter 確認，再來兩項先輸入 no 跳過，接著會讓你確認即將產生的內容，最後再按 enter 確認即可：</p><pre class="line-numbers language-none"><code class="language-none">This command will guide you through creating your pyproject.toml config.Package name [reminder-bot]:Version [0.1.0]:  Description []:  Author [Your Name &lt;you@example.com&gt;, n to skip]:  License []:  Compatible Python versions [^3.9]:Would you like to define your main dependencies interactively? (yes&#x2F;no) [yes] noWould you like to define your development dependencies interactively? (yes&#x2F;no) [yes] noGenerated file[tool.poetry]name &#x3D; &quot;reminder-bot&quot;version &#x3D; &quot;0.1.0&quot;description &#x3D; &quot;&quot;authors &#x3D; [&quot;JHTNT &lt;jerry1106666@gmail.com&gt;&quot;]readme &#x3D; &quot;README.md&quot;packages &#x3D; [&#123;include &#x3D; &quot;reminder_bot&quot;&#125;][tool.poetry.dependencies]python &#x3D; &quot;^3.9&quot;[build-system]requires &#x3D; [&quot;poetry-core&quot;]build-backend &#x3D; &quot;poetry.core.masonry.api&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到目錄裡多了 <code>pyproject.toml</code> 就表示初始化完成了。</p><h2 id="管理-poetry-虛擬環境">管理 Poetry 虛擬環境</h2><p>Poetry 整合了 <code>virtualenv</code>，預設強制將套件安裝在虛擬環境，若輸入指令時<strong>不在虛擬環境中</strong>會自動<strong>建立一個新的虛擬環境</strong>。</p><p>但是 Poetry 預設將虛擬環境放在同一個資料夾集中管理，個人更偏好 <code>venv</code> 建立在專案目錄內的方式，因此需要修改 Poetry 的設定。</p><h3 id="修改-poetry-config">修改 Poetry config</h3><p>輸入 <code>poetry config --list</code> 來查看有哪些指令，我們要修改的是 <code>virtualenvs.in-project = null</code> 這一項</p><p>使用以下指令來修改設定：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry config virtualenvs.in-project <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>若之前建立過虛擬環境先刪除：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry <span class="token function">env</span> remove python<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接著建立新的虛擬環境（若電腦只有一個 Python 版本）:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry <span class="token function">env</span> use python<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>建立新的虛擬環境（使用 pyenv 管理）</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">poetry env use $<span class="token punctuation">(</span>pyenv which python<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="note info flat"><p>關於使用 pyenv 管理 Python 版本可以參考<a href="../pyenv">使用 pyenv 管理 Python 版本</a>。</p></div><h3 id="啟動與退出虛擬環境">啟動與退出虛擬環境</h3><p>輸入 <code>poetry shell</code> 啟動虛擬環境，再輸入 <code>exit</code> 可以退出。</p><h2 id="poetry-指令">Poetry 指令</h2><h3 id="新增套件">新增套件</h3><p>相當於 <code>pip install</code>，會詳細列出安裝了哪些套件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry <span class="token function">add</span> <span class="token operator">&lt;</span>package name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以發現 <code>pyproject.toml</code> 的 <code>tool.poetry.dependencies</code> 區域多了剛剛新增的套件及版本，且只有我們<strong>主動新增</strong>的套件。</p><h3 id="新增開發環境套件">新增開發環境套件</h3><p>在開發專案時可能會用到一些測試或檢查的工具，但在部署時是不需要的，此時可以加上 <code>--dev</code> 或 <code>-D</code> 參數，將工具與必要的套件區分。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry <span class="token function">add</span> <span class="token operator">&lt;</span>package name<span class="token operator">></span> <span class="token parameter variable">--dev</span>poetry <span class="token function">add</span> <span class="token operator">&lt;</span>package name<span class="token operator">></span> <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>這樣新增的套件會出現在 <code>tool.poetry.dev-dependencies</code> 區域。</p><h3 id="poetry-lock-的更新"><code>poetry.lock</code> 的更新</h3><p>執行上述的 <code>poetry add</code> 以及稍後會介紹的 <code>poetry remove</code> 時可以發現，除了 <code>pyproject.toml</code> 以外還有另一個叫 <code>poetry.lock</code> 的檔案內容會變動。這個檔案相當於 pip 的 <code>requirements.txt</code>，記錄了所有安裝的套件與版本。</p><p>當你執行 <code>poetry add</code> 時，Poetry 實際上做了三件事：</p><ol><li>更新 <code>pyproject.toml</code></li><li>解析 <code>pyproject.toml</code> 的套件版本後，更新 <code>poetry.lock</code></li><li>根據 <code>poetry.lock</code> 的內容更新專案的套件</li></ol><p>由於 <code>pyproject.toml</code> 與 <code>poetry.lock</code> 不會自動同步，若<strong>手動編輯</strong> <code>pyproject.toml</code> 後需要更新 <code>poetry.lock</code> 的內容，可以使用 <code>poetry lock</code> 指令，但直接執行的話會「順便」將依賴套件更新到最新版，這可能會導致某些問題，因此可以加上 <code>--no-update</code> 參數來避免此行為：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry lock --no-update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>更新完 <code>poetry.lock</code> 之後還不會更新套件，需要再執行此指令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="更新套件">更新套件</h3><p>指令很直覺，就是 <code>update</code>，這樣會一次更新專案中所有可更新的套件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>若只想要更新特定幾個套件，可以在後面指定套件名稱：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry update <span class="token operator">&lt;</span>package <span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>package <span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>需要注意的是可以更新的版本會受到 <code>pyproject.toml</code> 的限制，例如 <code>black = &quot;^23.3.0&quot;</code>。比較常用的是語意化版本的方式，可以查看<strong>語意化版本 (Semantic Versioning) 是什麼</strong>（未寫），其他詳細的方法參考 Poetry 的官方文件 <a href="https://python-poetry.org/docs/dependency-specification/">Dependency specification</a>。</p><h3 id="列出套件清單">列出套件清單</h3><p>指令為 <code>poetry show</code>，等同於 <code>pip list</code>。注意套件清單的來源是 <code>poetry.lock</code> 而不是虛擬環境。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry show<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>若要使用樹狀顯示可以加上 <code>--tree</code> 參數，可以很<strong>直觀</strong>的看出主要套件與其依賴套件的關係：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry show <span class="token parameter variable">--tree</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>還可以只顯示指定套件的依賴清單：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry show <span class="token operator">&lt;</span>package name<span class="token operator">></span> <span class="token parameter variable">--tree</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="移除套件">移除套件</h3><p>使用方法就跟 <code>poetry add</code> 一樣，加上 <code>--dev</code> 或 <code>-D</code> 可以移除開發用的套件。</p><p>這也是與 pip 最大的不同，Poetry 具有<strong>相依性管理</strong>的能力，可以確認要移除的套件有哪些依賴套件，並確保這些依賴套件不被其他套件使用才移除。</p><h3 id="輸出-requirements-txt">輸出 <code>requirements.txt</code></h3><p>有時候在某些環境還是會有使用 <code>requirements.txt</code> 的需求，此時可以用 <code>poetry export</code> 來導出套件，雖然看起來跟平常熟知的 <code>requirements.txt</code> 不一樣，但還是能正常使用。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">poetry <span class="token builtin class-name">export</span> <span class="token parameter variable">-o</span> requirements.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="reference">Reference</h2><ul><li><a href="https://blog.kyomind.tw/python-poetry/">再見了 pip！最佳 Python 套件管理器——Poetry 完全入門指南 - Code and Me</a></li><li><a href="https://python-poetry.org/docs/">Introduction | Documentation | Poetry - Python dependency management and packaging made easy</a></li><li><a href="https://realpython.com/dependency-management-python-poetry/#handle-poetrylock">Dependency Management With Python Poetry – Real Python</a></li><li><a href="https://github.com/python-poetry/poetry/issues/5252#issuecomment-1194889183">PyEnv + Poetry: Poetry does not use correct Python versions · Issue #5252 · python-poetry/poetry</a></li><li><a href="https://github.com/python-poetry/poetry/issues/3248">breaking change: invert <code>lock --no-update</code> to <code>lock --update</code> (or similar) · Issue #3248 · python-poetry/poetry</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 實用工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 pyenv 管理 Python 版本</title>
      <link href="/posts/pyenv/"/>
      <url>/posts/pyenv/</url>
      
        <content type="html"><![CDATA[<h2 id="安裝-pyenv">安裝 pyenv</h2><h3 id="windows-系統">Windows 系統</h3><p>建議使用它的另一個 Windows 專用版本 <a href="https://github.com/pyenv-win/pyenv-win">pyenv-win</a>：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Invoke-WebRequest</span> <span class="token operator">-</span>UseBasicParsing <span class="token operator">-</span>Uri <span class="token string">"https://raw.githubusercontent.com/pyenv-win/pyenv-win/master/pyenv-win/install-pyenv-win.ps1"</span> <span class="token operator">-</span>OutFile <span class="token string">"./install-pyenv-win.ps1"</span><span class="token punctuation">;</span> &amp;<span class="token string">"./install-pyenv-win.ps1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="note info flat"><p>若輸入指令時出現 <code>因為這個系統上已停用指令碼執行，所以無法載入...</code> 的錯誤，這是 Windows 為了安全性考量預設使用了最嚴格的限制。</p><p>將其改為 <code>RemoteSigned</code> 或以下的限制等級即可，請以<strong>管理員</strong>身分開啟 PowerShell，並輸入以下指令然後確認。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-ExecutionPolicy</span> <span class="token operator">-</span>ExecutionPolicy RemoteSigned <span class="token operator">-</span>Scope LocalMachine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p>安裝完成後可刪除執行指令目錄下殘留的 <code>install-pyenv-win.ps1</code>。</p><h3 id="其他系統">其他系統</h3><p>參考 <a href="https://github.com/pyenv/pyenv#installation">GitHub 頁面的說明</a>。</p><h2 id="使用教學">使用教學</h2><p>以下操作環境為 Windows，<code>pyenv</code> 以外的指令可能略有不同</p><h3 id="搜尋可安裝版本">搜尋可安裝版本</h3><p><code>pyenv install -l</code> 會列出<strong>所有</strong>可安裝的 Python 版本。不過直接輸出內容會很長，建議搭配 <code>findstr</code> 篩選特定版本。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">pyenv install <span class="token operator">-</span>l <span class="token punctuation">|</span> findstr 3<span class="token punctuation">.</span>10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>確認版本號碼後進行安裝，此步驟會在使用者家目錄的 <code>.pyenv/pyenv/versions</code> 資料夾安裝一個新的 Python 環境（安裝時可能需要等待一段時間）。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv <span class="token function">install</span> <span class="token number">3.10</span>.11<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解除安裝改用 <code>pyenv uninstall</code> 即可。</p><h3 id="設定全域與區域版本">設定全域與區域版本</h3><p>先查詢目前可用的 Python 版本（經由上面的指令安裝的）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv versions<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在專案目錄使用此指令可以設定此目錄預設的 Python 版本，執行後專案目錄會出現一個 <code>.python-version</code> 檔案。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv <span class="token builtin class-name">local</span> <span class="token operator">&lt;</span>版本號<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接著可以設定全域預設的 Python 版本，若不設定此項，則 pyenv 會使用經由環境變數找到的 Python 執行檔。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv global <span class="token operator">&lt;</span>版本號<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="查詢指令位置">查詢指令位置</h3><p><code>pyenv which &lt;command&gt;</code> 可以查詢指令執行的檔案路徑。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pyenv <span class="token function">which</span> pythonpyenv <span class="token function">which</span> pip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="reference">Reference</h2><ul><li><a href="https://github.com/pyenv/pyenv">pyenv/pyenv: Simple Python version management</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 實用工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AP325 練習題解 (Ch03)</title>
      <link href="/posts/ap325-ch03/"/>
      <url>/posts/ap325-ch03/</url>
      
        <content type="html"><![CDATA[<h2 id="p-3-1-樹的高度與根">P-3-1. 樹的高度與根</h2><div class="note info flat"><p>這題在這裡主要是練習 queue 的用法，針對 tree 的解法在 P-8-4（題目相同）。</p></div><p>先記錄每個節點的 parent，同時將沒有 child 的節點加入 queue。重複將執行以下動作：</p><ol><li>從 queue 中 pop 一個節點 <code>v</code>。</li><li>將 <code>v</code> 的高度（節點到最遠 child 的距離，初始化時皆為 0）加到 total，並找出該節點的 parent <code>p</code>。</li><li>若此節點沒有 parent (<code>p == 0</code>)，表示已經到達這個 tree 的 root，將迴圈 break。</li><li>更新 parent 的高度為 <code>max(height[p], height[v] + 1)</code>。</li><li>若 parent 的所有 child 已經遍歷過，則將 <code>p</code> 加入 queue。</li></ol><h2 id="p-3-2-括弧配對">P-3-2. 括弧配對</h2><p>這題要檢查一串括號是否左右平衡。首先逐一將括號放入 stack，由於每次檢查都要確認是三種括號的哪種很花時間，因此先建立一個字串 <code>([&#123;)]&#125;</code>，將六個括號編號為 0 ~ 5，只在加入 stack 時搜尋<strong>一次</strong>並記錄對應編號。</p><p>若遇到右括號，則檢查是否能配對。根據上面的字串，左括號有對應的右括號編號相差 3，藉此來檢查 stack 的 top 是否與右括號配對，配對成功就 pop。若檢查完最後一個括號且 stack 為空表示是平衡的。</p><h2 id="q-3-3-加減乘除">Q-3-3. 加減乘除</h2><p>這題的運算式只有加減乘除，不包含括號，且數字為一位正整數，因此不算太複雜。乘除的優先級大於加減，因此需要將加減先放在 stack 內，確認後一個運算子為何。</p><p>首先設 <code>res</code> 為運算結果，初始值為第一位數字。之後重複將運算子與數字組成一個 <strong>pair</strong> 來運算，首先確認 stack 是否為空，若是空的且運算子為乘除，直接與 <code>res</code> 運算，運算子為加減則加入 stack。</p><p>若 stack 不是空的，取出 top 的 pair <code>tmp</code>，運算子為乘除與 <code>tmp</code> 的數字運算並 push 回 stack；運算子為加減，將 <code>tmp</code> 與 <code>res</code> 運算，並將新的 pair push 到 stack。</p><p>最後檢查 stack 有無殘留的 pair 並進行運算，<code>res</code> 即為最後結果。</p><h2 id="p-3-4-最接近的高人">P-3-4. 最接近的高人</h2><p>這題要找到前方比自己高且最接近的人的距離，若沒有比自己高的則為前方人數總和，相當於將第 0 個人設為無限高。</p><p>首先建立一個 stack，每讀入一筆資料，就用 while 將 stack 內小於等於該筆資料的 pop 掉（由於是線性讀取資料，while 總次數不會超過 <code>n</code>）。因為若第 <code>i - 1</code> 個人的身高小於等於第 <code>i</code> 個人矮，則第 <code>i - 1</code> 個人必不可能成後後面的人的「高人」。</p><p>清理完前面的資料後，計算自己與「高人」的距離加入 <code>total</code>，然後將自己 push 到 stack 裡。重複到最後一筆資料，最後的 <code>total</code> 即為答案。</p><h2 id="reference">Reference</h2>]]></content>
      
      
      <categories>
          
          <category> 競程筆記 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AP325 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AP325 練習題解 (Ch02)</title>
      <link href="/posts/ap325-ch02/"/>
      <url>/posts/ap325-ch02/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/JHTNT/OnlineJudge/tree/master/AP325/Ch02">第二章程式碼</a></p><h2 id="q-2-4-快速冪-200-位整數">Q-2-4. 快速冪–200 位整數</h2><p>快速冪是將指數拆分成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span> 次冪，例如：</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>3</mn><mn>13</mn></msup><mo>=</mo><msup><mn>3</mn><mrow><mo stretchy="false">(</mo><mn>1101</mn><msub><mo stretchy="false">)</mo><mn>2</mn></msub></mrow></msup><mo>=</mo><msup><mn>3</mn><mn>8</mn></msup><mo>⋅</mo><msup><mn>3</mn><mn>4</mn></msup><mo>⋅</mo><msup><mn>3</mn><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">3^{13} = 3^{(1101)_2} = 3^8 \cdot 3^4 \cdot 3^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">1</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></p><p>由於 1 次的平方是 2 次，2 次的平方是 4 次，依此類推，計算 n 次的複雜度只需要 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>，實作出來就是快速冪的迴圈法。</p><p>由於這題的 x 的範圍遠超過 long long，因此需要先取 x mod p 的餘數：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">x <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">%</span> p <span class="token operator">+</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">)</span> <span class="token operator">%</span> p<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="q-2-5-快速計算費式數列第-n-項">Q-2-5. 快速計算費式數列第 n 項</h2><p>首先，根據費式數列定義可以得出</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}f(n) \\f(n - 1)\end{bmatrix} = \begin{bmatrix}1 &amp; 1 \\1 &amp; 0 \end{bmatrix} \begin{bmatrix}f(n - 1) \\f(n - 2)\end{bmatrix} = \begin{bmatrix}1 &amp; 1 \\1 &amp; 0\end{bmatrix}^{n - 2} \begin{bmatrix}1 \\1\end{bmatrix} = \begin{bmatrix}1 &amp; 1 \\1 &amp; 0\end{bmatrix}^{n - 1} \begin{bmatrix}1 \\0\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.604038em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.604038em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>可以擴展為</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\begin{bmatrix}f(n + 1) &amp; f(n) \\f(n) &amp; f(n - 1)\end{bmatrix} = \begin{bmatrix}1 &amp; 1 \\1 &amp; 0\end{bmatrix}^{n - 1} \begin{bmatrix}1 &amp; 1 \\1 &amp; 0\end{bmatrix} = \begin{bmatrix}1 &amp; 1 \\1 &amp; 0\end{bmatrix}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.604038em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.454322em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.504292em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></p><p>接著使用 fast doubling 來簡化矩陣運算：</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mn>2</mn><mi>n</mi></mrow></msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mn>2</mn></msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\begin{bmatrix}f(2n + 1) \\f(2n)\end{bmatrix} &amp;= \begin{bmatrix}1 &amp; 1 \\1 &amp; 0\end{bmatrix}^{2n} \begin{bmatrix}1 \\0\end{bmatrix} \\&amp;= \begin{bmatrix}f(n + 1) &amp; f(n) \\f(n) &amp; f(n - 1)\end{bmatrix}^2 \begin{bmatrix}1 \\0\end{bmatrix}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.808076000000002em;vertical-align:-2.654038000000001em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.154038000000001em;"><span style="top:-5.154038000000001em;"><span class="pstrut" style="height:3.654008em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span><span style="top:-2.2499999999999996em;"><span class="pstrut" style="height:3.654008em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.654038000000001em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.154038000000001em;"><span style="top:-5.154038000000001em;"><span class="pstrut" style="height:3.654008em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span><span style="top:-2.2499999999999996em;"><span class="pstrut" style="height:3.654008em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.654038000000001em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>得到奇數與偶數的公式分別為：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">f(2n + 1) = f(n + 1)^2 + f(n)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>2</mn><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(2n) = f(n)(2f(n + 1) - f(n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></li></ul><p>再使用快速冪的方法計算（注意回傳的值是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 與 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(n + 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 組成的 pair）：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> P <span class="token operator">=</span> <span class="token number">1000000007</span><span class="token punctuation">;</span>pair<span class="token operator">&lt;</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token operator">></span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> p <span class="token operator">=</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// p.first = f(n), p.second = f(n + 1)</span>    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">.</span>second <span class="token operator">-</span> p<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token operator">%</span> P<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> c <span class="token operator">+=</span> P<span class="token punctuation">;</span>    c <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>first <span class="token operator">*</span> c<span class="token punctuation">)</span> <span class="token operator">%</span> P<span class="token punctuation">;</span>    <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>first <span class="token operator">*</span> p<span class="token punctuation">.</span>first <span class="token operator">+</span> p<span class="token punctuation">.</span>second <span class="token operator">*</span> p<span class="token punctuation">.</span>second<span class="token punctuation">)</span> <span class="token operator">%</span> P<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>d<span class="token punctuation">,</span> c <span class="token operator">+</span> d<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>c<span class="token punctuation">,</span> d<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由於計算平方時可能會 overflow，因此 pair 要用 long long。取餘數時可能會出現 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>P</mi><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>&gt;</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">f(n) &lt; P, f(n + 1) &gt; P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span> 的情況，導致 c 變成<strong>負數</strong>，因此要將 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> 的公式拆成兩部分額外判斷負數。</p><h2 id="q-2-7-互補團隊">Q-2-7. 互補團隊</h2><p>這題可以使用與 <a href="../ap325-ch01#p-1-7-%E5%AD%90%E9%9B%86%E5%90%88%E4%B9%98%E7%A9%8D">P-1-7. 子集合乘積</a> 相同的方法，第 i 個 bit 為 1 表示包含第 i 個字母：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> m<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// bits 0 ~ (m - 1) are 1</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    cin <span class="token operator">>></span> s<span class="token punctuation">;</span>    <span class="token keyword">int</span> team <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>        team <span class="token operator">|=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> team<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然後將陣列 sort 後，使用雙指針分別從前後往中間檢查，當兩數相加等於 k 表示互補，當後指針大於前指針即可結束遍歷。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">></span> i <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> k <span class="token operator">-</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> j<span class="token operator">--</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> k<span class="token punctuation">)</span> cnt<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="q-2-8-模逆元">Q-2-8. 模逆元</h2><p>由於除法不像加、減、乘一樣，可以對每個數取模而不影響結果，例如 <code>(3 * 6 / 3) % 7</code> 不等於 <code>(3 % 7) * (6 % 7) / (3 % 7)</code>，這樣在運算過程可能<strong>超過 long long</strong> 時會造成困擾。我們可以用模逆元來將除法轉換為乘法來解決這個問題。</p><p>模逆元又稱為模反元素，也就是在<strong>模運算下的乘法反元素</strong>，若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo>≡</mo><mn>1</mn><mrow><mspace></mspace><mspace width="0.4444444444444444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>b</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">ax\equiv 1{\pmod{b}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46375em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444444444444444em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span>，則 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">a, x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span></span></span></span> 互為模 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> 的模逆元，同時也可寫成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>≡</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mi>a</mi></mfrac></mstyle><mrow><mspace></mspace><mspace width="0.4444444444444444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>b</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">x\equiv \cfrac{1}{a}{\pmod{b}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46375em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5899999999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">a</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span><span class="mord"><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444444444444444em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span>。</p><p>套用到剛剛的例子，3 mod 7 的模逆元為 5，因此可以把式子變為 <code>(3 % 7) * (6 % 7) * (5 % 7)</code>，得到的答案是一樣的。</p><p>除了最直覺的窮舉法以外，有兩個主要方法可以求模逆元：</p><details class="toggle" ><summary class="toggle-button" style="">擴展歐幾里得算法</summary><div class="toggle-content"><p>歐幾里得算法，也就是我們熟悉的<strong>輾轉相除法</strong>，用來求得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> 兩數的最大公因數。擴展歐幾里得算法則是在求出最大公因數的同時，找出符合以下等式（貝祖等式）的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x, y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span>：</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ax + by = \gcd(a, b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span></p><p>從歐幾里得算法可以得知 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\gcd(a, b) = \gcd(b, a\bmod b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.05555555555555555em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.05555555555555555em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span>，又 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>b</mi><mo>=</mo><mi>a</mi><mo>−</mo><mi>k</mi><mi>b</mi><mo separator="true">,</mo><mi>k</mi><mo>=</mo><mo stretchy="false">⌊</mo><mi>a</mi><mi mathvariant="normal">/</mi><mi>b</mi><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">a\bmod b = a - kb, k = \lfloor a / b\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.05555555555555555em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.05555555555555555em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⌊</span><span class="mord mathdefault">a</span><span class="mord">/</span><span class="mord mathdefault">b</span><span class="mclose">⌋</span></span></span></span>。因此可以對上面的等式進行處理：</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mo>−</mo><mi>k</mi><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>b</mi><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><mo stretchy="false">(</mo><mi>a</mi><mo>−</mo><mi>k</mi><mi>b</mi><mo stretchy="false">)</mo><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>a</mi><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>+</mo><mi>b</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>−</mo><mi>k</mi><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}ax + by &amp;= \gcd(a, b) \\&amp;= \gcd(b, a\bmod b) \\&amp;= \gcd(b, a - kb) \\&amp;= bx&#x27; + (a - kb)y&#x27; \\&amp;= ay&#x27; + b(x&#x27; - ky&#x27;)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.500000000000002em;vertical-align:-3.5000000000000018em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span><span style="top:-4.659999999999999em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.1599999999999984em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.6599999999999984em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.15999999999999837em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5000000000000018em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span><span style="top:-4.659999999999999em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.05555555555555555em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace" style="margin-right:0.05555555555555555em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span><span style="top:-3.1599999999999984em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span><span style="top:-1.6599999999999984em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">b</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-0.15999999999999837em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">b</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5000000000000018em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>可以用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>y</mi><mo>=</mo><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>−</mo><mi>k</mi><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x = y&#x27;, y = x&#x27; - ky&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.835222em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.946332em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 來遞迴求解，當 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 時終止，此時 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x = 1, y = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>。</p><p>回到模逆元的公式，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo>≡</mo><mn>1</mn><mrow><mspace></mspace><mspace width="0.4444444444444444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>b</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">ax\equiv 1{\pmod{b}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46375em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444444444444444em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></span> 等於 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo>−</mo><mi>k</mi><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">ax - kb = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，設 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>k</mi><mo>=</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">-k = y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> 得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">ax + by = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，求出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> 即為 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 的模逆元：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">exgcd</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exgcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    y <span class="token operator">-=</span> a <span class="token operator">/</span> b <span class="token operator">*</span> x<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="note warning flat"><p>由於使用擴展歐幾里得求出的解有可能是<strong>負數</strong>，此時需要再加上 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> 使其變為正數。</p></div><p>此方法的複雜度是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log(\min(a, b)))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>，只要模逆元存在（也就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a, b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> <strong>互質</strong>）就能使用，是最穩定的方法，費法小定理則限定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> 必須為<strong>質數</strong>。</p></div></details><details class="toggle" ><summary class="toggle-button" style="">費馬小定理</summary><div class="toggle-content"><p>根據費馬小定理，若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 為整數，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 為<strong>質數</strong>，則</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>≡</mo><mn>1</mn><mrow><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">a^{p-1}\equiv 1{\pmod p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.864108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span></span></span></p><p>將一個 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 提出後可以得到</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>⋅</mo><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msup><mo>≡</mo><mn>1</mn><mrow><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">a\cdot a^{p-2}\equiv 1{\pmod p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.864108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span></span></span></p><p>因此我們可以直接用快速冪求出 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msup><mspace></mspace><mspace width="0.4444444444444444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a^{p-2}\pmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.4444444444444444em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span> 即為 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 的模逆元。</p></div></details><h2 id="q-2-10-子集合的和-折半枚舉">Q-2-10. 子集合的和(折半枚舉)</h2><p>首先將輸入的陣列拆成兩半，用遞迴分別枚舉小於 <code>p</code> 的和並存入 <code>s1</code>, <code>s2</code> 兩個 set，接著遍歷 <code>s1</code>，尋找小於 <code>p</code> 的最大值：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span>LL e <span class="token operator">:</span> s1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    tmp <span class="token operator">=</span> e <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">prev</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>p <span class="token operator">-</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp <span class="token operator">></span> MAX<span class="token punctuation">)</span> MAX <span class="token operator">=</span> tmp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>由於 set 的資料是有序的，這裡使用 <code>s1.lower_bound()</code> 來求出<strong>大於或等於</strong> <code>p - e</code> 的最小值的位置，此函式回傳的是<strong>雙向迭代器</strong>，因此我們可以用 <code>prev()</code> 來取得前一個位置，也就是<strong>小於</strong> <code>p - e</code> 的最大值的位置，再用 <code>*</code> 取值。</p><div class="note info flat"><p>若使用 <code>s1.lower_bound()</code> 搜尋的值超過集合的最大值會回傳 <code>s1.end()</code>，使用 <code>prev()</code> 取到的值就會是此集合的最大值。</p></div><h2 id="q-2-12-最接近的子矩陣和-未解決">Q-2-12. 最接近的子矩陣和（未解決）</h2><p>這題跟例題一樣使用前綴和 + set 來解時複雜度為 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>m</mi><mn>2</mn></msup><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m^2 n\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span>，但離 1s 的時間限制還有很大的差距，若之後找到更好的方法會在此處補上。</p><h2 id="q-2-13-無理數的快速冪">Q-2-13. 無理數的快速冪</h2><p>假設給定的無理數是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><msqrt><mn>2</mn></msqrt></mrow><annotation encoding="application/x-tex">a + b\sqrt{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.13278em;"></span><span class="mord mathdefault">b</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span></span>，與另一無理數 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>+</mo><mi>y</mi><msqrt><mn>2</mn></msqrt></mrow><annotation encoding="application/x-tex">x + y\sqrt{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.10166em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span></span> 相乘的結果為</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><msqrt><mn>2</mn></msqrt><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><msqrt><mn>2</mn></msqrt><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>a</mi><mi>x</mi><mo>+</mo><mn>2</mn><mi>b</mi><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>a</mi><mi>y</mi><mo>+</mo><mi>b</mi><mi>x</mi><mo stretchy="false">)</mo><msqrt><mn>2</mn></msqrt></mrow><annotation encoding="application/x-tex">(a + b\sqrt{2})(x + y\sqrt{2}) = (ax + 2by) + (ay + bx)\sqrt{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.206095em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.956095em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.916095em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.08390500000000001em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.206095em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.956095em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.916095em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.08390500000000001em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.206095em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.956095em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.916095em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.08390500000000001em;"><span></span></span></span></span></span></span></span></span></span></p><p>若是自身的平方則為</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><msqrt><mn>2</mn></msqrt><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><msup><mi>b</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mi>a</mi><mi>b</mi><msqrt><mn>2</mn></msqrt></mrow><annotation encoding="application/x-tex">(a + b\sqrt{2})^2 = (a^2 + 2b^2) + 2ab\sqrt{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.206095em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.956095em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.916095em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.08390500000000001em;"><span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.08390500000000001em;"></span><span class="mord">2</span><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.956095em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span></span></span><span style="top:-2.916095em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.08390500000000001em;"><span></span></span></span></span></span></span></span></span></span></p><p>將上述結果套入前綴和的函式即可。</p><h2 id="q-2-14-水槽">Q-2-14. 水槽</h2><p>這題可以使用遞迴，根據不同情況來計算水量並逐漸縮減區間。</p><p>首先將所有<strong>擋板高度</strong>與其<strong>編號</strong>以 <code>pair&lt;long long, int&gt;</code> 的形式存在陣列裡，再由高到低排序。運算過程可能會超過 int 上限，所以使用 long long 儲存擋板高度。</p><p>進入遞迴時，先找出區間內最高的擋板（開區間，不包含左邊界和右邊界）。由於會逐漸縮減區間，每次找到的最高擋板都會被排除，我們可以用一個全域變數儲存當前區間最高擋板的 index，之後只要往後單向搜尋即可。</p><p>計算時需要考慮以下四種情況：</p><ol><li>區間內只有一個水槽，則水位等於剩餘水量，return。</li><li>若剩餘水量大於等於 <code>區間內水槽數 x 最高擋板高度</code>，表示足以淹沒整個區間，則區間內水位均為平均值，return。</li><li>若無法淹沒整個區間，則以最高擋板為準分成兩邊，若水量不足以淹沒<strong>包含注入點</strong>的這一邊（不會溢出到另一邊），則將縮小區間再次遞迴。</li><li>若水量能淹沒包含包含注入點的區間，則這一邊的水位皆為最高擋板的高度，則求出剩餘水量後縮減區間，並更改注入點為<strong>緊鄰最高擋板的水槽</strong>。</li></ol><p>整個遞迴函式皆操作同一個陣列，計算結束後直接輸出即可。##</p><h2 id="p-2-15-圓環出口">P-2-15. 圓環出口</h2><p>講義中提到可以將儲存房間點數的 <code>p[]</code> 變成前綴和的形式，此時 <code>p[]</code> 為單調（遞增或遞減）陣列，可以用二分搜來搜尋。</p><p>我們可以在輸入 <code>q</code> 的同時進行計算。首先建立一個變數 <code>room</code> 表示當前在哪個房間，若不在第 0 個房間，則將 <code>q</code> 加上前綴和 <code>p[room - 1]</code>，補足前面房間的分數。如果加完後 <code>q &gt; p[n - 1]</code> 表示途中會回到第 0 個房間，將 <code>q</code> 減去 <code>p[n - 1]</code> 並將 <code>room</code> 設為 0。最後用 <code>lower_bound()</code> 搜尋後進到下一個房間（注意超過第 n 個房間要回到 0）。</p><h2 id="reference">Reference</h2><ul><li><a href="https://oi-wiki.org/math/binary-exponentiation/">快速幂 - OI Wiki</a></li><li><a href="https://dwye.dev/post/python-fibonacci-2/">Python 費氏數列解法（二）：矩陣解</a></li><li><a href="https://oi-wiki.org/math/combinatorics/fibonacci/">斐波那契数列 - OI Wiki</a></li><li><a href="https://www.geeksforgeeks.org/fast-doubling-method-to-find-the-nth-fibonacci-number/">Fast Doubling method to find the Nth Fibonacci number - GeeksforGeeks</a></li><li><a href="https://zhuanlan.zhihu.com/p/378728642">乘法逆元 - 知乎</a></li><li><a href="https://cp.wiwiho.me/gcd/">歐幾里得演算法 - WiwiHo 的競程筆記</a></li><li><a href="https://oi-wiki.org/lang/csl/iterator/">迭代器 - OI Wiki</a></li><li><a href="https://yuihuang.com/zj-f162/">【題解】ZeroJudge f162: 4. 獵人與斯芬克斯 – Yui Huang 演算法學習筆記</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 競程筆記 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AP325 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AP325 練習題解 (Ch01)</title>
      <link href="/posts/ap325-ch01/"/>
      <url>/posts/ap325-ch01/</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>最近在找題目練習時，突然想到之前連第一章都沒看完的 AP325 （<a href="https://drive.google.com/drive/u/0/folders/10hZCMHH0YgsfguVZCHU7EYiG8qJE5f-m">講義下載</a>），決定趁著寒假讀一下，順便做個筆記。由於例題在講義內都有滿詳細的說明，因此這裡紀錄的解法以習題為主。</p><p><a href="https://github.com/JHTNT/OnlineJudge/tree/master/AP325/Ch01">第一章程式碼</a></p><h2 id="q-1-2-合成函數-2">Q-1-2. 合成函數(2)</h2><p>這題跟 P-1-1 用一樣的方法做就好了。不過我是用 C++ 寫的，因此在 <code>eval()</code> 裡判斷第一個輸入是不是數字的方法不同：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> n<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>cin <span class="token operator">>></span> n <span class="token operator">&amp;&amp;</span> cin<span class="token punctuation">)</span> <span class="token keyword">return</span> n<span class="token punctuation">;</span>cin<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>首先嘗試進行 cin，若讀取數字失敗，則 failbit 會被設置，此時 <code>if (cin)</code> 會是 false，因此只有當正確讀取數字才會 return n。由於 failbit 被設置時 cin 無法正常運作，因此執行 <code>cin.clear()</code> 清除 failbit 才能正常執行之後的 cin。</p><h2 id="q-1-4-支點切割">Q-1-4. 支點切割</h2><p>這題可以用前綴和 (left prefix sum) 與後綴和 (right prefix sum) 來解。</p><p><code>lps[i]</code> 表示從 <code>left</code> 到 <code>i</code> 的乘積總和，<code>rps[i]</code> 同理。根據題目的公式，<code>abs(rps[i] - lps[i])</code> 就是該切點的 cost。</p><p>以範例測資為例：</p><table><thead><tr><th style="text-align:center">index</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody><tr><td style="text-align:center">delta</td><td>0</td><td>p1</td><td>p1 + p2</td><td>p1 + p2 + p3</td><td>p1 + p2 + p3 + p4</td></tr><tr><td style="text-align:center">lps[i]</td><td>0</td><td>p1</td><td>2p1 + p2</td><td>3p1 + 2p2 + p3</td><td>4p1 + 3p2 + 2p3 + p4</td></tr></tbody></table><table><thead><tr><th style="text-align:center">index</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr></thead><tbody><tr><td style="text-align:center">delta</td><td>p2 + p3 + p4 + p5</td><td>p3 + p4 + p5</td><td>p4 + p5</td><td>p5</td><td>0</td></tr><tr><td style="text-align:center">rps[i]</td><td>p2 + 2p3 + 3p4 + 4p5</td><td>p3 + 2p4 + 3p5</td><td>p4 + 2p5</td><td>p5</td><td>0</td></tr></tbody></table><p>然後再找出 cost 最小的 i 即為此區間的最佳切點。</p><h2 id="q-1-5-二維黑白影像編碼">Q-1-5. 二維黑白影像編碼</h2><p>這題直接照著題目敘述做就好了，將字串從左到右遍歷，遇到 1 就將 <code>res</code> 加上 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>，遇到 2 就進入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord">/</span><span class="mord">2</span></span></span></span> 的遞迴。</p><h2 id="p-1-7-子集合乘積">P-1-7. 子集合乘積</h2><p>這題的迴圈作法有用到 bitwise operator，<code>&lt;&lt;</code> 與 <code>&gt;&gt;</code> 分別代表左移與右移，超出範圍（例如 int 有 32 bits）的 bits 被捨棄，另一側補 0。</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> 個數字（包含重複）的子集合個數是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span>（需要排除空集合），每個數字分為有跟沒有兩種情況，可以用 bit 的 1 與 0 表示。例如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">n = 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> 表示子集合個數為 25，第 <code>11001</code> 種情況代表此集合包含第 1、2、5 三個數字。</p><p>最後用 <code>&amp;</code> 來檢查每一位是否為 1，<code>11001 &amp; 01000</code> 的結果為 <code>01000</code>，非零表示包含第 2 個數字。</p><h2 id="p-1-9-n-queen-解的個數">P-1-9. N-Queen 解的個數</h2><p>講義中提到可以用 <code>abs(p[i] - p[j]) == j - i</code> 來判斷是否在對角線，此處以 4 * 4 的棋盤為例，每個數字代表第幾個皇后，- 表示空格：</p><table><tbody><tr><td>-</td><td>-</td><td>2</td><td>-</td></tr><tr><td>-</td><td>-</td><td>-</td><td>3</td></tr><tr><td>0</td><td>-</td><td>-</td><td>-</td></tr><tr><td>-</td><td>1</td><td>-</td><td>-</td></tr></tbody></table><p>由於 2 號皇后在第 0 列，3 號皇后在第 1 列，此時 <code>p[2] = 0, p[3] = 1</code>。套用上面的條件，可以發現兩個皇后確實在同一個對角線上，1 號與 3 號同理。</p><hr><p>第二個遞迴解的 <code>i = k - j + p[j]</code> 與 <code>i = p[j] - (k - j)</code> 代表的意思我想了很久，其實就只是對角線的位置。以上面的棋盤為例，假設目前 <code>k = 1, j = 0, p = [2, ?, ?, ?]</code> （其他皇后位置未定），此時 <code>valid = [T, T, F, T]</code> （直線也是攻擊範圍），套用兩個算式得到 <code>i</code> 分別為 1, 3，頂式此兩格處於其他皇后的攻擊範圍，標記為不可放置，<code>valid = [T, F, F, F]</code>。</p><h2 id="q-1-10-最多得分的皇后">Q-1-10. 最多得分的皇后</h2><p>這題可以用 P-1-9 的遞迴解，需要考慮的部分是<strong>不一定</strong>要放滿 n 個皇后，我用 -1 表示不放，最後計算分數時遇到 -1 不算該格分數（但是這個方法不夠優化）。</p><p>下面是最關鍵的部分，迴圈裡面照一般的解法，結束後追加一個 -1 表示此列不放皇后，<code>res</code> 用於儲存最高的分數。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        p<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>        res <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">nq</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>p<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>res <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">nq</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="q-1-11-刪除矩形邊界-遞迴">Q-1-11. 刪除矩形邊界 — 遞迴</h2><p>這題可以把矩陣設為全域變數，這樣遞迴函式只需要傳入四個邊界與 cost。直接計算四個邊各自的 cost，再縮減邊界繼續遞迴即可。如果左邊界等於右邊界，或上邊界等於下邊界，表示只剩一行或一列，此時就不用繼續往下遞迴了。</p><h2 id="reference">Reference</h2><ul><li><a href="https://yuihuang.com/zj-f638/">【題解】ZeroJudge f638: 支點切割 - Yui Huang 演算法學習筆記</a></li><li><a href="https://oi-wiki.org/basic/prefix-sum/">前缀和 &amp; 差分 - OI Wiki</a></li><li><a href="https://web.ntnu.edu.tw/~algo/Bit.html">Bit - 演算法筆記</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 競程筆記 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AP325 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解決 VSCode 無法正確編譯 C/C++ 的問題</title>
      <link href="/posts/vscode-cannot-compile-c/"/>
      <url>/posts/vscode-cannot-compile-c/</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>前陣子想用 C++ 寫個題目，突然發現編譯後雖然執行了，但在終端機怎麼輸入都沒反應，檢查 <code>launch.json</code> 跟 <code>tasks.json</code> 也都沒動過。後來在<a href="https://stackoverflow.com/questions/72038699/vs-code-doesnt-take-input-in-debug-mode-while-debugging-c-files-how-to-prov">這篇問答</a>裡看到可能是某次更新後 VSCode 對 gcc 的最低版本要求提高了。</p><h2 id="升級-gcc-版本">升級 gcc 版本</h2><p>使用 <code>gcc -v</code> 指令可以查看版本，結果發現我裝的 MinGW 版本只有 6.3.0 （目前最新版本為 12.2.0）。先把舊版的 gcc 刪除（記得把<strong>系統環境變數</strong>的 path 也刪除），然後下載最新版的 <a href="https://winlibs.com/">WinLibs</a> (UCRT runtime)，解壓縮到方便存取的位置，再將 <code>mingw64/bin/</code> 的絕對位置寫到環境變數的 path，最後修改 <code>launch.json</code> 的 gdb 位置就完成了。</p><p>分享一下自己的配置：</p><pre class="line-numbers language-json" data-language="json"><div class="caption"><span>launch.json</span></div><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"(gdb) Launch"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceRoot&#125;\\temp.exe"</span><span class="token punctuation">,</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceRoot&#125;"</span><span class="token punctuation">,</span>            <span class="token property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>            <span class="token property">"miDebuggerPath"</span><span class="token operator">:</span> <span class="token string">"C:\\mingw64\\bin\\gdb.exe"</span><span class="token punctuation">,</span>            <span class="token property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"啟用 gdb 的美化顯示"</span><span class="token punctuation">,</span>                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>                    <span class="token property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"build"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><div class="caption"><span>task.json</span></div><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>            <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"g++"</span><span class="token punctuation">,</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"-g"</span><span class="token punctuation">,</span> <span class="token string">"$&#123;file&#125;"</span><span class="token punctuation">,</span> <span class="token string">"-o"</span><span class="token punctuation">,</span> <span class="token string">"temp.exe"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"group"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>                <span class="token property">"isDefault"</span><span class="token operator">:</span> <span class="token boolean">true</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 疑難雜症 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 部署時自動更新文章的編輯時間</title>
      <link href="/posts/Hexo-auto-modify-updated-time-when-deploy/"/>
      <url>/posts/Hexo-auto-modify-updated-time-when-deploy/</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>昨天修改了文章後，發現更新時間沒有跟著改變，查了一下似乎只能自行更改 front-matter （markdown 最上面那一區）裡的 <code>updated</code>。</p><p>但是每次改一篇文章都要手動修改感覺有點蠢，於是我繼續尋找有沒有辦法自動化，最後找到了使用 JavaScript 的方法。以下程式碼修改自原文章，順便做個筆記。</p><h2 id="為現有文章加上-updated">為現有文章加上 updated</h2><p>若文章 front-matter 還沒有 <code>updated</code>，需要手動加入，可以直接複製 <code>date: xxxx-xx-xx xx:xx:xx</code> 這行，然後把 <code>date</code> 改成 <code>updated</code> 就好（之後執行程式會自動修正）。</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml">title: 在 Hexo 部署時自動更新文章的編輯時間date: 2023-01-18 15:09:05updated: 2023-01-20 21:33:18categories:  - 架站筆記tags:  - Hexo  - JavaScript</span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="修改模板">修改模板</h2><p>我們當然不會想要每次都手動加上 <code>updated</code>，因此需要修改模版的 front-matter：</p><pre class="line-numbers language-markdown" data-language="markdown"><div class="caption"><span>post.md</span></div><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml">title: &#123;&#123; title &#125;&#125;date: &#123;&#123; date &#125;&#125;updated: &#123;&#123; date &#125;&#125;categories:  - tags:  -</span> <span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>這樣以後生成新文章就會自動加上 <code>updated</code> 了。</p><h2 id="自動修改更新日期">自動修改更新日期</h2><p>在根目錄建立 <code>UpdateFileTime.js</code> （若放在 <code>source/</code> 裡，deploy 時會生成在網站裡）：</p><pre class="line-numbers language-javascript" data-language="javascript"><div class="caption"><span>UpdateFileTime.js</span></div><code class="language-javascript"><span class="token hashbang comment">#!/usr/bin/env node</span><span class="token comment">// 自動更新文章的修改時間</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'開始執行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用於讀寫文件</span><span class="token keyword">var</span> RegExp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(updated:\s*)((\d&#123;2&#125;(([02468][048])|([13579][26]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|([1-2][0-9])))))|(\d&#123;2&#125;(([02468][1235679])|([13579][01345789]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|(1[0-9])|(2[0-8]))))))(\s((([0-1][0-9])|(2?[0-3]))\:([0-5]?[0-9])((\s)|(\:([0-5]?[0-9])))))</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span><span class="token keyword">let</span> toppath <span class="token operator">=</span> <span class="token string">"./source/_posts/"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path <span class="token operator">+</span> item<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token function">writeFileTime</span><span class="token punctuation">(</span>path <span class="token operator">+</span> item<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token function">fn</span><span class="token punctuation">(</span>path <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span>toppath<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">writeFileTime</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> fs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 讀取文件內容</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"讀取檔案內容錯誤："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 尋找 updated 字串</span>            fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token comment">// 讀取文件建立時間等資訊</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"讀取檔案資料錯誤："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> updateds <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> updated <span class="token operator">=</span> updateds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"updated: "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 時間格式化為 xxxx/xx/xx xx:xx:xx</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>updated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 只要修改時間和文章內 updated 時間差大於 10 分鍾就觸發更新</span>                    <span class="token keyword">var</span> result <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">,</span> <span class="token string">"updated: "</span> <span class="token operator">+</span> <span class="token function">getFormatDate</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 替換更新時間</span>                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>                    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> result<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 寫入新的檔案內容</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>                        fs<span class="token punctuation">.</span><span class="token function">utimes</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>atime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 還原訪問時間和修改時間</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"修改時間失敗："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">"成功更新時間"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* timeStr:時間，格式可為："September 16,2016 14:15:05、 "September 16,2016"、"2016/09/16 14:15:05"、"2016/09/16"、 '2014-04-23T18:55:49'和毫秒 dateSeparator：年、月、日之間的分隔符，預設為"-"， timeSeparator：時、分、秒之間的分隔符，預設為":" */</span><span class="token keyword">function</span> <span class="token function">getFormatDate</span><span class="token punctuation">(</span><span class="token parameter">timeStr<span class="token punctuation">,</span> dateSeparator<span class="token punctuation">,</span> timeSeparator</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    dateSeparator <span class="token operator">=</span> dateSeparator <span class="token operator">?</span> dateSeparator <span class="token operator">:</span> <span class="token string">"-"</span><span class="token punctuation">;</span>    timeSeparator <span class="token operator">=</span> timeSeparator <span class="token operator">?</span> timeSeparator <span class="token operator">:</span> <span class="token string">":"</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeStr<span class="token punctuation">)</span><span class="token punctuation">,</span>        year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 四位數</span>        month <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 0-11</span>        day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">// 1-31</span>        hour <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment">// 0-23</span>        minute <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 0-59</span>        seconds <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 0-59</span>        <span class="token constant">Y</span> <span class="token operator">=</span> year <span class="token operator">+</span> dateSeparator<span class="token punctuation">,</span>        <span class="token constant">M</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> dateSeparator<span class="token punctuation">,</span>        <span class="token constant">D</span> <span class="token operator">=</span> <span class="token punctuation">(</span>day <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> day <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">+</span> day<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span><span class="token punctuation">,</span>        h <span class="token operator">=</span> <span class="token punctuation">(</span>hour <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> hour <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">+</span> hour<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> timeSeparator<span class="token punctuation">,</span>        m <span class="token operator">=</span> <span class="token punctuation">(</span>minute <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> minute <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">+</span> minute<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> timeSeparator<span class="token punctuation">,</span>        s <span class="token operator">=</span> <span class="token punctuation">(</span>seconds <span class="token operator">></span> <span class="token number">9</span> <span class="token operator">?</span> seconds <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">+</span> seconds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        formatDate <span class="token operator">=</span> <span class="token constant">Y</span> <span class="token operator">+</span> <span class="token constant">M</span> <span class="token operator">+</span> <span class="token constant">D</span> <span class="token operator">+</span> h <span class="token operator">+</span> m <span class="token operator">+</span> s<span class="token punctuation">;</span>    <span class="token keyword">return</span> formatDate<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="updatefiletime-js-解析">UpdateFileTime.js 解析</h3><p>在這裡做個筆記，避免之後忘了這段程式在做什麼。</p><ul><li><p>Line 5: <code>fs</code> (file system) module 用於讀寫文件。</p></li><li><p>Line 7: <code>updated</code> 與時間格式的正則表達式 (regular expression)，型別是 <code>RegExp</code>。</p><ul><li>若後面加上 g (global) 變成 <code>/.../g</code>，會搜尋所有符合的結果，否則只會搜尋第一個符合的，可以避免文章內的 <code>updated</code> 也被替換。</li></ul></li><li><p>Line 9 ~ 26: 只尋找 <code>source/_post/</code> 內的檔案，只選取 <code>.md</code> 檔，其他檔案跳過，若是目錄則繼續遞迴。選中的檔案進行時間更新。</p><ul><li>Line 11: <code>fs.readdir(path[, options], callback)</code> 讀取資料夾內所有檔案，callback 是參數為 <code>err, data</code> 的 function。</li></ul></li><li><p>Line 30: 需使用 UTF-8 打開，否則可能會編碼錯誤。</p></li><li><p>Line 32 &amp; 35: <code>RegExp.test(str)</code> 可以檢查 <code>str</code> 內是否有符合 <code>RegExp</code> 的部分。<code>str.match(RegExp)</code> 則會回傳一個包含所有符合結果的陣列。</p></li><li><p>Line 33: <code>fs.stat(path[, options], callback)</code> 會回傳一個 <code>fs.Stats</code> 物件，結構如下：</p><pre class="line-numbers language-none"><code class="language-none">Stats &#123;  dev: 16777220,  mode: 33188,  nlink: 1,  uid: 501,  gid: 20,  rdev: 0,  blksize: 4096,  ino: 14214074,  size: 8,  blocks: 8,  atimeMs: 1561174616618.8555,  mtimeMs: 1561174614584,  ctimeMs: 1561174614583.8145,  birthtimeMs: 1561174007710.7478,  atime: 2019-06-22T03:36:56.619Z,  mtime: 2019-06-22T03:36:54.584Z,  ctime: 2019-06-22T03:36:54.584Z,  birthtime: 2019-06-22T03:26:47.711Z&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Line 40: 由於執行這個程式會更動到檔案，因此使用 <code>fs.utimes()</code> 將存取與編輯時間還原成執行前的狀態。</p></li></ul><div class="note default flat"><p>我在寫這段的時候遇到一個笨問題，不管怎麼執行，文章的 <code>updated</code> 都沒有更新，一開始以為是出 bug，上網找了各種方法都沒用。<br>後來發現 VSCode 不會即時同步檔案（我一直以為會），把檔案關掉重開就是正確的結果了。</p></div><h3 id="執行檔案">執行檔案</h3><p>在根目錄執行一次這個檔案並查看效果：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">node</span> .<span class="token punctuation">\</span>source<span class="token punctuation">\</span>UpdateFileTime.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="在遠端-pull-更新正確時間">在遠端 pull 更新正確時間</h2><div class="note warning flat"><p>使用這段的腳本前提是原始檔案 （至少包含 <code>source/_post/</code>）已經被 git 追蹤，否則不會有效果。</p></div><p>若我們在其他電腦將原始檔案 pull 下來，檔案的最後編輯時間會變成 pull 的時間，會導致執行 <code>UpdateFileTime.js</code> 時全部變成當天的日期，因此在 pull 之後可以執行下面的腳本，將最後編輯時間復原為最後一次 commit 的時間（若檔案沒有被 git 追蹤則不變）。</p><pre class="line-numbers language-bash" data-language="bash"><div class="caption"><span>restoreTime.sh</span></div><code class="language-bash"><span class="token function">git</span> ls-files <span class="token parameter variable">-z</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> path<span class="token punctuation">;</span><span class="token keyword">do</span>    <span class="token function">touch</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log <span class="token parameter variable">-1</span> <span class="token parameter variable">--format</span><span class="token operator">=</span><span class="token string">"@%ct"</span> <span class="token string">"<span class="token variable">$path</span>"</span><span class="token variable">)</span></span>"</span> <span class="token string">"<span class="token variable">$path</span>"</span><span class="token punctuation">;</span><span class="token keyword">done</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="note warning flat"><p>Windows 預設的換行格式是 CRLF (<code>\r\n</code>)，請確保將此檔案的換行格式轉為 <strong>LF</strong> (<code>\n</code>)，否則執行時會出現錯誤。</p></div><p>解析：</p><ul><li><p><code>git ls-files</code>: 顯示當前目錄中所有被 git 追蹤的檔案：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> ls-filesaaa.mdbbb.mdccc.md<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>|</code>: pipe，將左邊的輸出作為右邊的輸入。</p><div class="note warning flat"><p>由於 pipe 裡的每個指令都會在獨立的 subshell 執行，因此在 pipe 裡產生的變數不會影響到外部。</p></div></li><li><p><code>read</code>: 讀入資料，分割並分配給後面的變數。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">read</span> var1 var2 <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"Hello world!"</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$var1</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> var2Helloworld<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>while read path</code>: 重複「讀取直到換行後傳給變數 <code>path</code>」到輸入結束為止。</p><ul><li><code>do</code>、<code>done</code> 分別為迴圈的開頭與結束。</li></ul></li><li><p><code>touch</code>: 用於更改檔案或目錄的時間戳記，或是建立空檔案。</p><ul><li><code>-d</code>: 設定日期與時間，其中一種格式為，使用 Unix timestamp 前面要加上 <code>@</code>。</li></ul></li><li><p><code>git log</code>: 顯示 commit 紀錄。</p><ul><li><code>-&lt;n&gt;</code>: 顯示最後 n 筆 commit。</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> log <span class="token parameter variable">-1</span>commit 8cf50d13ccb7983e8c406573bf834fa9394418aa <span class="token punctuation">(</span>HEAD -<span class="token operator">></span> master<span class="token punctuation">)</span>Author: JHTNT <span class="token operator">&lt;</span>xxxxx@gmail.com<span class="token operator">></span>Date:   Wed Oct <span class="token number">12</span> <span class="token number">16</span>:25:10 <span class="token number">2022</span> +0800    Draft: temp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>--format</code>: 可以自訂輸出的格式，例如：<ul><li><code>%H</code>, <code>%h</code>: 顯示完整 / 簡短的 commit hash 值。</li><li><code>%an</code>: 作者的名字。</li><li><code>%cn</code>: 提交者的名字。</li><li><code>%ct</code>: 以 UNIX timestamp 形式顯示 commit 時間。</li><li><code>%cs</code>: 以 <code>YYYY-MM-DD</code> 形式顯示 commit 時間。</li></ul></li></ul></li></ul><h2 id="一鍵部署">一鍵部署</h2><p>我們可以將 <code>UpdateFileTime.js</code> 與 Hexo 部署的指令寫成一個腳本，方便之後直接一鍵部署，並同時將原始檔案 push 到 github，關於儲存原始檔案可以查看<a href="../Jekyll-to-Hexo#%E5%8F%A6%E5%AD%98%E5%8E%9F%E5%A7%8B%E6%AA%94%E6%A1%88">這篇</a>。</p><pre class="line-numbers language-batch" data-language="batch"><div class="caption"><span>deploy.bat</span></div><code class="language-batch"><span class="token command"><span class="token keyword">call</span> node .\UpdateFileTime.js</span><span class="token command"><span class="token keyword">call</span> git add .</span><span class="token command"><span class="token keyword">call</span> git commit <span class="token parameter attr-name">-m</span> <span class="token variable">%1</span></span><span class="token command"><span class="token keyword">call</span> git push</span><span class="token command"><span class="token keyword">call</span> hexo clean</span><span class="token command"><span class="token keyword">call</span> hexo generate</span><span class="token command"><span class="token keyword">call</span> hexo deploy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之後要部署只需要在根目錄執行 <code>.\deploy.bat &quot;[commit message]&quot;</code> 指令即可（記得加上引號），例如：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.<span class="token punctuation">\</span>deploy.bat <span class="token string">"add: commit test"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><div class="note default flat"><p>雖然最後編輯時間會與 commit 時間有所差別，但目前沒找到解決辦法，且我覺得不會造成太大的問題，因此就暫時保持這樣。</p></div><h2 id="reference">Reference</h2><ul><li><a href="https://www.anubis.cafe/dde5360c.html">hexo 自动更新文章修改时间 | Anubis的小窝</a></li><li><a href="https://zhuanlan.zhihu.com/p/573210619">hexo 自动更新文章修改时间 - 知乎</a></li><li><a href="https://github.com/theme-next/hexo-theme-next/issues/893">The update time of the article is incorrect · Issue #893 · theme-next/hexo-theme-next</a></li><li><a href="https://git-scm.com/docs/git-ls-files">Git - git-ls-files Documentation</a></li><li><a href="https://stackoverflow.com/questions/5760640/left-side-of-pipe-is-the-subshell">bash - Left side of pipe is the subshell? - Stack Overflow</a></li><li><a href="https://phoenixnap.com/kb/bash-read">How To Use The Bash read Command {10 Examples}</a></li><li><a href="https://stackoverflow.com/questions/57497365/what-does-the-bash-read-d-do">delimiter - What does the bash read -d ‘’ do? - Stack Overflow</a></li><li><a href="https://www.runoob.com/linux/linux-comm-touch.html">Linux touch命令 | 菜鸟教程</a></li><li><a href="https://git-scm.com/docs/git-log">Git - git-log Documentation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 架站筆記 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 常用語法</title>
      <link href="/posts/Hexo-syntax/"/>
      <url>/posts/Hexo-syntax/</url>
      
        <content type="html"><![CDATA[<p>此頁面為記錄 Hexo 內建的一些特殊語法，方便自己日後查閱。</p><h2 id="note">Note</h2><p>語法：</p><pre class="line-numbers language-none"><code class="language-none">&#123;% note [class] [no-icon] [style] %&#125;content&#123;% endnote %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>class  <div class="note default flat"><p>default</p></div>    <div class="note primary flat"><p>primary</p></div>    <div class="note success flat"><p>success</p></div>    <div class="note info flat"><p>info</p></div>    <div class="note warning flat"><p>warning</p></div>    <div class="note danger flat"><p>danger</p></div></li><li>no-icon  <div class="note info no-icon flat"><p>no icon</p></div></li><li>style  <div class="note info simple"><p>simple</p></div>    <div class="note info modern"><p>modern</p></div>    <div class="note info flat"><p>flat</p></div>    <div class="note info disabled"><p>disabled</p></div></li></ul><h2 id="toggle">Toggle</h2><p>語法：</p><pre class="line-numbers language-none"><code class="language-none">&#123;% hideToggle display, bg, color %&#125;content&#123;% endhideToggle %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>display<br>Toggle 的標題，若需要英文逗號 <code>,</code> 則必須用 <code>&amp;sbquo;</code> 代替。</li><li>bg<br>Toggle 標題的<strong>背景</strong>顏色，如 <code>#b85454</code>。</li><li>color<br>Toggle 標題的<strong>文字</strong>顏色，如 <code>#8bd0cb</code>。</li></ul><p>僅 display：</p><details class="toggle" ><summary class="toggle-button" style="">display</summary><div class="toggle-content"><pre class="line-numbers language-none"><code class="language-none">&#123;% hideToggle display %&#125;content&#123;% endhideToggle %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></details><p>加上 bg 與 color：</p><details class="toggle" style="border: 1px solid  #b85454"><summary class="toggle-button" style="background-color:  #b85454;color:  #8bd0cb">display</summary><div class="toggle-content"><pre class="line-numbers language-none"><code class="language-none">&#123;% hideToggle display, #b85454, #8bd0cb %&#125;content&#123;% endhideToggle %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></details><h2 id="label">Label</h2><p>語法：</p><pre class="line-numbers language-none"><code class="language-none">&#123;% label text color %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>color<ul><li><mark class="hl-label default">default</mark> </li><li><mark class="hl-label blue">blue</mark> </li><li><mark class="hl-label pink">pink</mark> </li><li><mark class="hl-label red">red</mark> </li><li><mark class="hl-label purple">purple</mark> </li><li><mark class="hl-label orange">orange</mark> </li><li><mark class="hl-label green">green</mark> </li></ul></li></ul><h2 id="reference">Reference</h2><ul><li><a href="https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89">Butterfly 安裝文檔(三) 主題配置-1 | Butterfly</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 架站筆記 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>從 Jekyll 到 Hexo</title>
      <link href="/posts/Jekyll-to-Hexo/"/>
      <url>/posts/Jekyll-to-Hexo/</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>原本 Jekyll 使用的是 <a href="https://github.com/poole/lanyon">Layon</a> 主題，想著一開始用極簡主題就好，有需要什麼功能再額外加上去。結果東加西加，網站的程式碼變得很雜亂，不如直接換一個主題。</p><p>後來想起之前看過朋友用 <a href="https://hexo.io/zh-tw/">Hexo</a> 架的網站看起來滿漂亮的，可以調整的設定不少，也支援 Markdown。因此打算從 Jekyll 轉換到 Hexo，同時作為一個新的開始。</p><div class="note info flat"><p>以下內容主要參考官方文檔，記錄自己安裝及配置的過程，Butterfly 相關配置在官方文檔都有詳盡的說明，此篇文章只紀錄部分較特別的設定。</p></div><h2 id="安裝">安裝</h2><p>安裝 Hexo 前需要先安裝 <a href="http://nodejs.org/">Node.js</a> （核心部分） 與 git （用於推送網頁）。</p><p>有了 Node.js 後就可以在終端機執行安裝指令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> hexo-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>建立一個資料夾作為 blog 的根目錄，進入該目錄後配置基本檔案：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>folder<span class="token operator">></span>hexo init<span class="token function">npm</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>安裝完後資料夾內的結構應該會長這樣：</p><pre class="line-numbers language-none"><code class="language-none">.├── _config.yml├── package.json├── scaffolds├── source|   ├── _drafts|   └── _posts└── themes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此時基本配置就完成了。</p><h2 id="選擇主題">選擇主題</h2><p>第一件事當然是要選擇一個順眼的主題，預設的主題是 <a href="https://theme-next.js.org/">NexT</a>，我選擇的是 <a href="https://butterfly.js.org/">Butterfly</a> 主題。除了好看以外，它的官方文檔還是<strong>中文</strong>的，對我這種英文苦手的人來說非常友好。</p><div class="note warning flat"><p>由於不同主題的配置不盡相同，因此更換主題時可能無法完美轉移。</p></div><p>安裝過程可直接參考 butterfly 的<a href="https://butterfly.js.org/posts/21cfbf15/">官方教學</a>。</p><h2 id="開始寫文章">開始寫文章</h2><p>在根目錄中輸入以下指令會自動在 <code>source/_posts/</code> 建立一個新的 Markdown 檔案：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new <span class="token punctuation">[</span>layout<span class="token punctuation">]</span> <span class="token operator">&lt;</span>title<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>layout 就是文章的初始佈局，存放在 <code>scaffholds</code> 資料夾中。以 <code>post.md</code> 為例，打開可以看到</p><pre class="line-numbers language-markdown" data-language="markdown"><div class="caption"><span>post.md</span></div><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml">title: &#123;&#123; title &#125;&#125;date: &#123;&#123; date &#125;&#125;tag:</span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>這個以 <code>---</code> 分隔的區塊可以當作是個別頁面的設定檔，以下是常用的變數：</p><ul><li><code>title</code> 標題 （預設為檔名）</li><li><code>data</code> 檔案建立日期</li><li><code>updated</code> 檔案修改日期</li><li><code>tags</code> 標籤</li><li><code>categories</code> 分類</li></ul><h3 id="分類與標籤">分類與標籤</h3><p>在 Hexo 中，分類的順序代表階層性，標籤則沒有差別。例如分類 <code>Foo, Bar</code> 表示文章屬於 Foo 分類下的 Bar 分類，一個頁面可以同時擁有<strong>多個分類與標籤</strong>：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">categories:    <span class="token list punctuation">-</span> [Sports, Baseball]    <span class="token list punctuation">-</span> Diarytags:    <span class="token list punctuation">-</span> Injury    <span class="token list punctuation">-</span> Shocking<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="修改預設檔案名稱">修改預設檔案名稱</h3><p>當文章數量逐漸增加時，全部塞在同一個資料夾找起來會很困難，因此想找一個能照年份分類的方法。</p><p>如果直接在 <code>source/_posts/2023</code> 裡建立文章，預設產生的文章連結會是 <code>https://jhtnt.github.io/2023/01/11/title</code>。如果想讓文章連結只有標題，例如 <code>https://jhtnt.github.io/posts/title</code>，可以如下修改 <code>_config.yml</code> 的配置。</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.yml</span></div><code class="language-yaml"><span class="token key atrule">permalink</span><span class="token punctuation">:</span> posts/<span class="token punctuation">:</span>name/<span class="token key atrule">new_post_name</span><span class="token punctuation">:</span> <span class="token punctuation">:</span>year/<span class="token punctuation">:</span>title.md<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>permalink</code> 指的是文章的永久連結，<code>new_post_name</code> 則是使用指令新增文章時產生的檔名，以下是幾個常用的變數：</p><ul><li><code>:title</code> 文章標題</li><li><code>:name</code> 文章<strong>檔名</strong></li><li><code>:year</code> 文章建立年分 （4 位數）</li><li><code>:month</code> 文章建立月分 （2 位數）</li><li><code>:day</code> 文章建立日期 （2 位數）</li></ul><h2 id="本地預覽">本地預覽</h2><p>有時我們會需要在正式部署前預覽網頁，這時可以使用 Hexo 的指令。</p><h3 id="generate">generate</h3><p>輸入 <code>hexo generate</code> 或 <code>hexo g</code> 可以生成靜態檔案，加上 <code>-w</code> 或 <code>--watch</code> 可以持續監看並即時生成檔案。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo generatehexo g <span class="token parameter variable">-w</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="serve">serve</h3><p><code>hexo server</code> 或 <code>hexo s</code> 可以啟動本機伺服器，預設 port 為 <code>http://localhost:4000/</code>。若與其他應用程式的 port 衝突，可以使用 <code>-p</code> 或 <code>--port</code> 來自訂 port。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo servehexo s <span class="token parameter variable">-p</span> <span class="token number">4001</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 server 啟動期間會持續監測檔案，效果與 <code>hexo g -w</code> 相同。不過似乎與 Jekyll 一樣只會監測 <code>source/</code> 裡的資源，若更改了 <code>_config.yml</code> 等檔案需要重新啟動伺服器才會生效。</p><h3 id="clean">clean</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo clean<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以清理快取檔案 (<code>db.json</code>) 和已產生的靜態檔案 (<code>public/</code>)。</p><div class="note info flat"><p>若不需要下面的設定，想要直接部署，可跳至 <a href="#%E9%83%A8%E7%BD%B2%E5%88%B0-github-pages">部署到 GitHub Pages</a></p></div><h2 id="自訂漸層背景">自訂漸層背景</h2><p>在 <code>_config.butterfly.yml</code> 中有一項設定是 <code>background</code>，可以設定網站的背景，研究後發現可以使用漸層顏色，於是在 <a href="https://webgradients.com/">WebGradients</a> 找了一個喜歡的顏色貼進設定裡：</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.butterfly.yml</span></div><code class="language-yaml"><span class="token key atrule">background</span><span class="token punctuation">:</span> <span class="token string">"linear-gradient(120deg, #fbc2eb 0%, #a6c1ee 100%)"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但當我切換成暗色模式後馬上發現不對勁，由於這個主題的暗色模式會對所有顏色加上一層透明度 70% 的黑色，雖然能減少亮度的刺激，卻導致原本的漸層變得很奇怪，於是我決定寫一個 CSS 檔案覆蓋主題的設定。</p><h3 id="新增自訂-css-檔案">新增自訂 CSS 檔案</h3><p>為了避免在更新主題時意外覆蓋掉自訂的檔案，將檔案放在根目錄的 <code>source/</code> 而不是主題目錄的 <code>source/</code> 會是比較好的選擇。</p><p>首先在建立一個存放 CSS 的資料夾 <code>source/css/</code> 在裡面建立 <code>custom.css</code> （檔名沒有限制）。然後進入 <code>_config.butterfly.yml</code> 找到 <code>inject</code> 並修改 （有兩個不同的 <code>inject</code>，請看註解辨別）：</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.butterfly.yml</span></div><code class="language-yaml"><span class="token comment"># Inject</span><span class="token comment"># Insert the code to head (before '&lt;/head>' tag) and the bottom (before '&lt;/body>' tag)</span><span class="token comment"># 插入代碼到頭部 &lt;/head> 之前 和 底部 &lt;/body> 之前</span><span class="token key atrule">inject</span><span class="token punctuation">:</span>  <span class="token key atrule">head</span><span class="token punctuation">:</span>    <span class="token comment"># - &lt;link rel="stylesheet" href="/xxx.css"></span>    <span class="token punctuation">-</span> &lt;link rel="stylesheet" href="/css/custom.css"<span class="token punctuation">></span>  <span class="token key atrule">bottom</span><span class="token punctuation">:</span>    <span class="token comment"># - &lt;script src="xxxx">&lt;/script></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>這樣就會在每個頁面的 <code>&lt;head&gt;</code> 導入這個檔案。</p><h3 id="修改背景顏色">修改背景顏色</h3><p>說回剛剛的背景顏色，找了很久發現是受下面這段 CSS 影響，最終我把透明度調成 <strong>50%</strong>，在不會過亮的情況下還不至於太奇怪。</p><pre class="line-numbers language-css" data-language="css"><div class="caption"><span>custom.css</span></div><code class="language-css"><span class="token selector">[data-theme='dark'] #web_bg:before</span> <span class="token punctuation">&#123;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>改完之後又出現一個問題，文章內部的背景還是黑色的，看起來有點突兀，於是讓它變成有點半透明的效果：</p><pre class="line-numbers language-css" data-language="css"><div class="caption"><span>custom.css</span></div><code class="language-css"><span class="token selector">#recent-posts>.recent-post-item</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.layout>#post</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#aside-content .card-widget</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最後將 footer 變成透明的就成功讓整體顏色一致了：</p><pre class="line-numbers language-css" data-language="css"><div class="caption"><span>custom.css</span></div><code class="language-css"><span class="token selector">#footer</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">[data-theme='dark'] #footer:before</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="自訂程式碼-highlight-主題">自訂程式碼 highlight 主題</h2><p>Hexo 內建提供 highlight.js 與 Prism.js 兩種 highlight 方式，預設是使用 highlight.js。但是 Prism.js 對程式碼的分割更加<strong>細緻</strong>，因此我想改用 Prism.js 順便修改配色。</p><p>首先關閉 <code>highlight</code> 並開啟 <code>prismjs</code>：</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.yml</span></div><code class="language-yaml"><span class="token key atrule">highlight</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">prismjs</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>之後在 <code>source/css/</code> 建立一個 CSS 檔案用於存放 highlight 配色，在這個 <a href="https://github.com/PrismJS/prism-themes">github repo</a> 有許多可用於 prismjs 的主題，我選擇的是 <strong>VS Code Dark+</strong>。接著將你要的主題的 CSS 複製到剛才建立的檔案，並在開頭插入這段 code （<code>xxxxxxx</code>） 表示預設顏色：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 新添加的內容  -------------------------------------   --hl-color                  代碼框字體顔色 【必須】 (把下面.hljs的 color複製到這裏來)  --hl-bg                     代碼框背景色 【必須】 (把下面.hljs的 background複製到這裏來)  --hltools-bg: #321a0f       代碼框頂部工具欄背景色 【可選】(如果你關掉了 copy、lang 和 shrink,可不用配置這個）  --hltools-color: #fff       代碼框頂部工具欄字體顔色 【可選】(如果你關掉了 copy、lang 和 shrink,可不用配置這個）  --hlnumber-bg: #221a0f      代碼框行數背景色 【可選】(如果已經關掉 line_number,可以不用配置這個)  --hlnumber-color: #fff      代碼框行數字體顔色 【可選】 (如果已經關掉 line_number,可以不用配置這個)  --hlscrollbar-bg: #d3af86   代碼框滾動條顔色 【可選】（默認為主題主顔色）  --hlexpand-bg: #d3af86      代碼框底部展開背景色 【可選】(如果已經關掉 highlight_height_limit,可以不用配置這個)*/</span><span class="token selector">:root</span> <span class="token punctuation">&#123;</span>    <span class="token property">--hl-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>    <span class="token property">--hl-bg</span><span class="token punctuation">:</span> #1e1e1e<span class="token punctuation">;</span>    <span class="token property">--hltools-bg</span><span class="token punctuation">:</span> xxxxxxx<span class="token punctuation">;</span>    <span class="token property">--hltools-color</span><span class="token punctuation">:</span> xxxxxxx<span class="token punctuation">;</span>    <span class="token property">--hlnumber-bg</span><span class="token punctuation">:</span> xxxxxxx<span class="token punctuation">;</span>    <span class="token property">--hlnumber-color</span><span class="token punctuation">:</span> xxxxxxxx<span class="token punctuation">;</span>    <span class="token property">--hlscrollbar-bg</span><span class="token punctuation">:</span> xxxxx<span class="token punctuation">;</span>    <span class="token property">--hlexpand-bg</span><span class="token punctuation">:</span> xxxxxxx<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* 下面是你所選的配色主題的 CSS */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最後設定好此檔案的 <code>inject</code> 就大功告成了。</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.butterfly.yml</span></div><code class="language-yaml"><span class="token key atrule">inject</span><span class="token punctuation">:</span>  <span class="token key atrule">head</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> &lt;link rel="stylesheet" href="/css/vscode_dark_theme.css"<span class="token punctuation">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="增加評論系統">增加評論系統</h2><p>我所選擇的系統是 Waline，主要原因是風格比較符合我的喜好，且可以匿名留言。部署過程不算太難，<a href="https://waline.js.org/guide/get-started">官方文檔</a>有詳盡的教學，此處只簡略描述：</p><h3 id="建立資料庫">建立資料庫</h3><div class="note warning flat"><p>我使用的資料庫是 MongoDB Atlas，並非 Waline 推薦的 LeanCloud，建立資料庫與下面的變數設定見<a href="https://candinya.com/posts/migrate-from-disqus-to-waline/">這篇文章</a>，除了 UI 有些許不同外其餘照著做即可。</p></div><h3 id="部署-vercel">部署 Vercel</h3><p>使用 Waline 文檔提供的連結進入 Vercel 頁面，登入 github 後依照步驟進行第一次部署。然後進入 Setting -&gt; Environment Variables 設定環境變數 （不同資料庫需要設定的環境變數不一樣）。</p><p>最後重新部署後取得 server 端位址，若沒有做額外設定連結應為 <code>https://xxxxx.vercel.app</code>，可以先隨意發一則評論測試是否設定成功。</p><h3 id="開啟-hexo-評論設定">開啟 Hexo 評論設定</h3><p>先指定使用 Waline，開啟 lazyload 則使用者滾動到評論位置時才會開始加載：</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.butterfly.yml</span></div><code class="language-yaml"><span class="token key atrule">comments</span><span class="token punctuation">:</span>  <span class="token key atrule">use</span><span class="token punctuation">:</span> Waline  <span class="token key atrule">lazyload</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>再來設定 Waline，除了 Butterfly 主題提供的幾個選項外，可以在 <code>option</code> 下新增 Waline 的<a href="https://waline.js.org/reference/client/props.html">自定義選項</a>。</p><div class="note warning flat"><p>需要特別注意在<a href="https://waline.js.org/cookbook/customize/locale.html">自定义语言</a>這頁的選項都屬於 <code>locale</code> 的子選項，寫法可參考下方的範例。<br><s>（發現選項沒有生效，研究了好幾個小時才發現原因）</s></p></div><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.butterfly.yml</span></div><code class="language-yaml"><span class="token key atrule">waline</span><span class="token punctuation">:</span>  <span class="token key atrule">serverURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//xxxxx.vercel.app  <span class="token key atrule">option</span><span class="token punctuation">:</span>    <span class="token key atrule">locale</span><span class="token punctuation">:</span>      <span class="token key atrule">locale</span><span class="token punctuation">:</span>      <span class="token key atrule">mail</span><span class="token punctuation">:</span> 電子信箱      <span class="token key atrule">placeholder</span><span class="token punctuation">:</span> 有任何問題或建議歡迎留言提出 <span class="token comment"># 評論框默認文字</span>      <span class="token key atrule">sofa</span><span class="token punctuation">:</span> 暫無留言 <span class="token comment"># 評論區為空時的顯示文字</span>    <span class="token key atrule">imageUploader</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 上傳圖片功能</span>    <span class="token key atrule">search</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 搜尋 gif 功能</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>這樣就設置完成了。</p><h2 id="渲染-katex">渲染 KaTeX</h2><p>一開始我使用了官方提供的<a href="https://butterfly.js.org/posts/ceeb73f/#Math-%E6%95%B8%E5%AD%B8">方法</a>，然而 <code>hexo-renderer-markdown-it</code> 無法成功渲染，而 <code>hexo-renderer-markdown-it-plus</code> 雖然成功了，但沒辦法顯示斜體感覺怪怪的。</p><p>最後我找到了<a href="https://www.nickxu.top/2022/04/17/Hexo-Butterfly-%E5%BB%BA%E7%AB%99%E6%8C%87%E5%8D%97%EF%BC%88%E5%85%AB%EF%BC%89%E4%BD%BF%E7%94%A8-KaTeX-%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/">這篇文章</a>，安裝 <a href="https://github.com/Abreto/hexo-renderer-markdown-it-katex"><code>hexo-renderer-markdown-it-katex</code></a> 後不需要額外設定即可渲染 KaTeX：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> un hexo-renderer-marked <span class="token parameter variable">--save</span> <span class="token comment"># 移除原本的渲染插件</span><span class="token function">npm</span> i hexo-renderer-markdown-it-katex <span class="token parameter variable">--save</span> <span class="token comment"># 安裝新插件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>KaTex 測試：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>n</mi></msub><mo>=</mo><mi>a</mi><mi>n</mi><mo>+</mo><mi>d</mi><mo>⋅</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mstyle></mrow><annotation encoding="application/x-tex">S_{n} = an + d \cdot {\cfrac{n(n-1)}{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.276em;vertical-align:-0.686em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5899999999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span></span></span></span></span></p><h2 id="增加搜尋系統">增加搜尋系統</h2><p>實際過程比想像中簡單，若只採用預設設定，只需要安裝 <code>hexo-generator-search</code>，並啟用搜尋功能即可。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-search <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.butterfly.yml</span></div><code class="language-yaml"><span class="token key atrule">local_search</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="部署到-github-pages">部署到 GitHub Pages</h2><p>終於將網站都布置好後，就可以準備部署到 github 上了。</p><p>首先在 github 上建立一個 repository，名稱<strong>必須</strong>為 <code>&lt;你的 username&gt;.github.io</code> （全小寫）。</p><p>要部署到 github 有兩種方式：</p><ul><li>GitHub Actions</li><li><code>hexo-deployer-git</code> 插件</li></ul><p>這裡我選擇比較方便使用的後者，首先安裝此插件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-deployer-git <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再來進行 <code>deploy</code> 的設定，注意 <code>url</code> 最後面不要有 <code>/</code>，<code>repo</code> 的部分，如果你的 username 包含大寫，不需要轉成小寫。</p><pre class="line-numbers language-yaml" data-language="yaml"><div class="caption"><span>_config.yml</span></div><code class="language-yaml"><span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//&lt;你的小寫 username<span class="token punctuation">></span>.github.io <span class="token comment"># 約在 16 行</span><span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> git  <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/&lt;你的完整 username<span class="token punctuation">></span>/&lt;剛剛建立的 repository 名稱<span class="token punctuation">></span>.git  <span class="token key atrule">branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最後每次部署前輸入以下指令即可：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo cleanhexo generatehexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div class="note info flat"><p>關於進階的部署（自動修改最後編輯時間）可以參考<a href="../Hexo-auto-modify-updated-time-when-deploy">這篇文章</a>。</p></div><h3 id="另存原始檔案">另存原始檔案</h3><p>由於 Hexo 部署時所產生的是最終的 html 等檔案，若需要在其他電腦編輯，還是使用原始檔案更方便，因此建議另外開一個 repository 儲存新檔案。</p><p>首先在根目錄初始化 git：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然後連結到新的 repository，在 github 頁面可以找到類似下方的指令，在根目錄執行即可連結到 repository：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> remote <span class="token function">add</span> origin https://github.com/<span class="token operator">&lt;</span>username<span class="token operator">></span>/<span class="token operator">&lt;</span>新 repo 名稱<span class="token operator">></span>.git<span class="token function">git</span> branch <span class="token parameter variable">-M</span> main<span class="token function">git</span> push <span class="token parameter variable">-u</span> origin main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="雜項">雜項</h2><p>此處為直接更改到主題檔案的部分，升級後需要重新修改。</p><div class="note warning flat"><p>在更新主題時，需要先將檔案復原再 pull 新版本的主題：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> .<span class="token punctuation">\</span>themes<span class="token punctuation">\</span>butterfly<span class="token punctuation">\</span><span class="token function">git</span> reset HEAD <span class="token parameter variable">--hard</span><span class="token function">git</span> pull<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><ul><li><p>取消當滑鼠放到頭像上會旋轉一圈<br><a href="https://github.com/jerryc127/hexo-theme-butterfly/discussions/878">link</a></p><pre class="line-numbers language-stylus" data-language="stylus"><div class="caption"><span>aside.styl</span></div><code class="language-stylus">&amp;<span class="token punctuation">:</span>hover<span class="token property-declaration"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token func"><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">360</span><span class="token unit">deg</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h2 id="reference">Reference</h2><ul><li><a href="https://hexo.io/zh-tw/docs/">文件 | Hexo</a></li><li><a href="https://ithelp.ithome.com.tw/users/20119486/ironman/2944">試著學 Hexo :: 第 12 屆 iThome 鐵人賽</a></li><li><a href="https://butterfly.js.org/posts/21cfbf15/">Butterfly 安裝文檔(一) 快速開始 | Butterfly</a></li><li><a href="https://prinsss.github.io/hexo-posts-in-subfolder/">使用子文件夹管理 Hexo 文章且不改变文章永久链接 - PRIN BLOG</a></li><li><a href="https://blog.imzjw.cn/posts/b74f504f/">关于我 Butterfly 主题的所有美化</a></li><li><a href="https://butterfly.js.org/posts/b37b5fe3/">自定義代碼配色 | Butterfly</a></li><li><a href="https://candinya.com/posts/migrate-from-disqus-to-waline/">从Disqus迁移到Waline | 糖菓·部落</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 架站筆記 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Jekyll </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
